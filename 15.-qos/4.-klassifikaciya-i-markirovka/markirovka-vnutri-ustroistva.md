# Маркировка внутри устройства

    Ещё раз: на входе в DS-домен может происходить классификация MF, Interface-based или BA.   
Между узлами DS-домена пакет несёт знак о необходимом ему классе сервиса в заголовке и классифицируется по BA.  
  
    Независимо от способа после классификации пакету присваивается внутренний класс в пределах устройства, в соответствии с которым он и обрабатывается. Заголовок при этом снимается, и голый \(нет\) пакет путешествует к выходу.  
А на выходе внутренний класс преобразуется в поле CoS нового заголовка.  
  
    В некоторых случаях нужно отобразить поле заголовка одного протокола в заголовок другого.  
Происходит это как раз через промежуточную внутреннюю маркировку.  
То есть Заголовок 1 ⇒ Внутренний класс сервиса ⇒ Заголовок 2.  
Чуть поподробнее об этом поговорим в [аппаратной главе](../9.-apparatnaya-realizaciya-qos.md).

    **Вот несколько условных таблиц соответствия между различными маркировками:**  
На примере Huawei. Здесь Service-Class — это та самая внутренняя маркировка пакета.  
  
    То есть, если на входе происходит классификация BA, то значения DSCP будут транслироваться в соответствующие им значения Service-Class и Color.

![](../../.gitbook/assets/image%20%2838%29.png)

  
    Здесь стоит обратить внимание на то, что многие значения DSCP не используются, и пакеты с такой маркировкой фактически обрабатываются, как BE.  
  
    Вот таблица обратного соответствия, которая показывает, какие значения DSCP будут установлены трафику при перемаркировке на выходе.

![](../../.gitbook/assets/image%20%2888%29.png)

  
    Обратите внимание, что только у AF есть градация по цветам. BE, EF, CS6, CS7 — все только Green.  
  
    Это таблица преобразования полей IPP, MPLS Traffic Class и Ethernet 802.1p во внутренние классы сервиса. 

![](../../.gitbook/assets/image%20%28126%29.png)



    И обратно.

![](../../.gitbook/assets/image%20%2889%29.png)

  
    Заметьте, что здесь вообще теряется какая-либо информация о приоритете отбрасывания.  
  
    Следует повториться — это только конкретный пример соответствий по умолчанию от наугад выбранного вендора. У других это может отличаться. На своей сети администраторы могут настроить совершенно отличные классы сервисов и PHB.

  
    В плане PHB нет абсолютно никакой разницы что используется для классификации — DSCP, Traffic Class, 802.1p.  
Внутри устройства они превращаются в классы трафика, определённые администратором сети.  
То есть все эти маркировки — это способ сообщить соседям, какой класс сервиса им следует назначить этому пакету. Это примерно, как BGP Community, которые не значат ничего сами по себе, пока на сети не определена политика их интерпретации.

