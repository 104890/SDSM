# 10. Базовый MPLS

## Сети для самых маленьких. Часть десятая. Базовый MPLS

Сеть нашей воображаемой компании linkmeup растёт. У неё есть уже магистральные линии в различных городах, клиентская база и отличный штат инженеров, выросших на цикле СДСМ.  
Но всё им мало. Услуги ШПД — это хорошо и нужно, но есть ещё огромный потенциальный рынок корпоративных клиентов, которым нужен VPN.  
Думали ребята над этим, ломали голову и пришли к выводу, что никак тут не обойтись без MPLS.

Если мультикаст был первой темой, которая требовала некоторого перестроения понимания IP-сетей, то, изучая MPLS, вам точно придётся забыть почти всё, что вы знали раньше — это особенный мир со своими правилами.

[![](https://img-fotki.yandex.ru/get/16123/83739833.47/0_100960_19e8ebfb_XXL.jpg)](https://img-fotki.yandex.ru/get/16123/83739833.47/0_100960_19e8ebfb_orig.jpg)

Сегодня в выпуске:

* [Что такое MPLS](10.-base-mpls.md#ABOUT_MPLS)
* [Передача трафика в сети MPLS](10.-base-mpls.md#FORWARDING)
* [Терминология](10.-base-mpls.md#GLOSSARY)
* [Распространение меток](10.-base-mpls.md#LABEL_DISTRIBUTION)
* [Методы распространение меток](10.-base-mpls.md#MODES)
* [DU против DoD](10.-base-mpls.md#DU_DOD)
* [Ordered Control против Independent Control](10.-base-mpls.md#LABEL_CONTROL)
* [Liberal Label Retention Mode против Conservative Label Retention Mode](10.-base-mpls.md#RETENTION_MODE)
* [PHP](10.-base-mpls.md#PHP)
* [Протоколы распространения меток](10.-base-mpls.md#PROTOCOLS)
* [LDP](10.-base-mpls.md#LDP)
* [Практика](10.-base-mpls.md#LDP_PRACTICE)
* [Применение чистого MPLS в связке с BGP](10.-base-mpls.md#MPLS-BGP)
* [RSVP-TE](10.-base-mpls.md#RSVP-TE)
* [Практика](10.-base-mpls.md#RSVP_PRACTICE)
* [ВиО](10.-base-mpls.md#FAQ)
* [Полезные ссылки](10.-base-mpls.md#USEFUL)

А начнём мы с вопроса: «Что не так с IP?»

[_Традиционное видео_ ](https://www.youtube.com/embed/hZyfM4UZDac)

А действительно, что не так? Зачем городить MPLS?  
Да всё так. Достоинства и недостатки IP вытекают из того, что он появился позже классических сетей и невероятно гибкий. Сейчас повсеместно идёт переход на пакетную коммутацию, в основу которой лёг IP на сетевом уровне, а на канальном всё большую популярность набирает Ethernet.  
Это хорошо, ведь теперь на базе одной опорной сети и сети доступа можно предоставлять [ШПД](http://lookmeup.linkmeup.ru/#term190), IP-телефонию, IPTV и другие возможные услуги.  
То же самое прослеживается и в сетях мобильных операторов. Сети второго поколения на заре были целиком на основе [коммутации каналов](http://lookmeup.linkmeup.ru/#term187). Ядро сетей 3G в большинстве своём уже IP, но услуги телефонии по-прежнему могут предоставляться в режиме коммутации каналов. Сети же 4G это уже полноценные IP-сети, где передача голоса — это лишь одно из приложений, также, как и ШПД.

Однако существует ещё огромное число сегментов, где используются старые технологии. Например, где-то есть ATM, в другом месте нужно PDH передать из одной части сети в другую, а тут клиент захотел, чтобы его кусок Ethernet-сети оказался доступным с другого конца города так, словно он подключен непосредственно — иными словами VPN.  
Как это решалось раньше: нужен ATM между двумя географическими точками — строй канал между ними на базе ATM, PDH — строй PDH.  
А хочется-то делать всё это через одну сеть, а не строить отдельную для каждого типа трафика.  
Для этого и были придуманы в своё время GRE, PPPoE, PPPoA, ATM over Ethernet, TDM over IP и многочисленные другие over'ы. Можно насоздавать ещё тысячу других, чтобы покрыть уже все комбинации, и настанет вселенское счастье в хаосе стандартов \(_к слову, некоторые мелкие производители по такому пути и пошли_\).

В середине 90-х горячим головам из нескольких компаний \(IBM, Toshiba, Cisco, Ipsilon\) пришло в голову создать механизм, который позволил бы при маршрутизации заглядывать не внутрь пакета и прочёсывать таблицу маршрутизации в поисках лучшего пути, а ориентироваться по некой метке. Выстрелило у Cisco, и механизм был назван незамысловато: TAG Switching.  
Причём цель, которую преследовали разработчики, заключалась в том, чтобы позволить высокоскоростным коммутаторам передавать трафик исключительно аппаратно. Дело в том, что аппаратная IP-маршрутизация долгое время была малодоступным удовольствием, и применять её на недорогих коммутаторах было нецелесообразно, а принимать решение на основе метки можно было бы просто и быстро.  
Но в то же время появились сверхбольшие интегральные схемы \(пусть я и не согласен с этим термином — английский [VLSI](http://en.wikipedia.org/wiki/Very-large-scale_integration) гораздо лучше описывает суть\), и задача экономии на анализе содержимого пакета стала не такой уж и актуальной. Кроме того появилось понятие FIB, которое предполагает, что для каждого пакета не нужно осуществлять поиск адресата в таблице маршрутизации и соответственно привлекать центральный процессор — вся горячая информация уже на линейной плате.  
То есть по сути необходимость в таком механизме отпала.

Но _внезапно_ стало понятно, что у коммутации по меткам есть незапланированный потенциал — совершенно неважно, что находится под меткой — IP, Ethernet, ATM, Frame Relay. А ещё она даёт возможность отвязаться от ограничений IP-маршрутизации.  
Отсюда и берёт своё начало технология, утверждённая IETF — MPLS — MultiProtocol Label Switching. Шёл 1997-й год.  
И эта, кажущаяся, возможно, незначительной, деталь дала начало новой эре в телекоммуникациях. Сегодня MPLS вы найдёте в любом более или менее крупном провайдере.

Основные применения MPLS сейчас:

* MPLS L2VPN
* MPLS L3VPN
* MPLS TE

О каждом из них мы поговорим в отдельных статьях — это чудовищно огромные темы. Но коротко мы затронем их в конце статьи.
